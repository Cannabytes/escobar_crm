# Модуль чатов

## Назначение
- Единый канал общения между всеми пользователями (публичные комнаты).
- Личные диалоги между двумя пользователями (приватные комнаты).
- Возможность создавать дополнительные публичные комнаты по темам.

## Данные и модели
- `chat_rooms` — комнаты (`type: public/private`, `slug` для публичных, автор создания).
- `chat_room_user` — участники комнат (для приватных обязательно, для публичных создаётся при первом сообщении).
- `chat_messages` — сообщения в комнатах (`body`, `is_system`).
- Модели: `ChatRoom`, `ChatMessage`.

## Доступ
- Любой авторизованный пользователь может:
  - просматривать список публичных комнат;
  - создавать публичные комнаты;
  - искать пользователя и создавать приватный чат;
  - отправлять сообщения в доступных комнатах.
- Приватные комнаты доступны только участникам.

## Веб-интерфейс (`/admin/chat`)
- Список публичных комнат с поиском по названию и участникам.
- Блок приватных чатов показывает всех пользователей системы (кроме текущего); клик создаёт чат или открывает существующий диалог.
- Создание публичной комнаты (модальное окно).
- Создание приватного чата через поиск (модальное окно) — для массовых списков.
- Лента сообщений с автообновлением (15 сек) и ручным обновлением.
- Отправка сообщений без перезагрузки (AJAX).

## API (используются во фронтенде)
- `GET /admin/chat/rooms` — список доступных комнат.
- `POST /admin/chat/rooms` — создание комнаты (`type=public|private`, для приватной `participant_id`).
- `GET /admin/chat/rooms/{room}/messages` — история сообщений (пагинация).
- `POST /admin/chat/rooms/{room}/messages` — отправка сообщения.
- `GET /admin/chat/users` — список всех пользователей с данными по существующим приватным диалогам.
- `GET /admin/chat/users/search?q=` — поиск пользователя для приватного чата.

## Примечания
- Для публичных комнат slug генерируется автоматически (для ЧПУ/будущих задач).
- В JS используется поллинг вместо WebSocket, совместимо с шаред-хостингом.
- В шаблоне используются стили из `vendor/css/pages/app-chat.css`.

