# Чат система

## Обзор

Чат система поддерживает приватные и публичные чаты. Публичные чаты доступны всем пользователям, приватные - между двумя пользователями.

## Функциональность

### Основные возможности
- Приватные чаты между пользователями
- Публичные чаты для всех пользователей
- Создание публичных чатов администраторами
- Управление чатами (переименование, очистка, удаление)
- Отметка сообщений как прочитанные
- Автообновление списка чатов и контактов
- Визуальное выделение непрочитанных сообщений

### API эндпоинты

#### Получение списка чатов и контактов
```
GET /admin/chat/rooms
```
Возвращает все публичные чаты и приватные чаты пользователя.

#### Создание публичного чата
```
POST /admin/chat/rooms
Content-Type: application/json

{
  "type": "public",
  "name": "Название чата"
}
```

#### Управление чатами
```
PUT /admin/chat/rooms/{room} - переименование чата
DELETE /admin/chat/rooms/{room} - удаление чата
DELETE /admin/chat/rooms/{room}/messages - очистка всех сообщений
POST /admin/chat/rooms/{room}/read - отметка чата как прочитанного
```

#### Сообщения
```
GET /admin/chat/rooms/{room}/messages - получение сообщений
POST /admin/chat/rooms/{room}/messages - отправка сообщения
```

## Безопасность

- Только создатель публичного чата или администратор может его редактировать/удалять
- Все сообщения фильтруются по доступу к комнате
- CSRF защита на всех формах

## База данных

### Таблицы
- `chat_rooms` - комнаты чатов
- `chat_room_user` - участники чатов с временем последнего прочтения
- `chat_messages` - сообщения

### Поля для непрочитанных сообщений
- `last_read_at` в таблице `chat_room_user` отслеживает время последнего прочтения
- Непрочитанные сообщения подсчитываются как сообщения после `last_read_at`

## Frontend

### Автообновление
- Сообщения: каждые 3 секунды
- Контакты и чаты: каждые 10 секунд

### Стилизация
- Непрочитанные сообщения выделены светло-желтым фоном
- Публичные чаты имеют синий аватар
- Меню управления доступно только для публичных чатов

## Производительность

- Индексы на `type`, `created_at` в таблицах чатов
- Ограничение количества сообщений на страницу (50)
- Ленивая загрузка для больших чатов
